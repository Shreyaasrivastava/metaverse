<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Diwakar Mandir Interior Tour</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', sans-serif; }
        #ui { position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 8px; pointer-events: none; z-index: 10; }
        .controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; z-index: 10; }
        button { padding: 12px 20px; cursor: pointer; background: #800000; color: white; border: none; border-radius: 5px; font-weight: bold; transition: 0.3s; min-width: 120px; }
        button:hover { background: #b00000; transform: translateY(-2px); }
        .exit-btn { background: #444; }
    </style>
</head>
<body>
    <div id="ui">
        <h1>दिवाकर मन्दिर (Interior)</h1>
        <p>Look around by dragging your mouse</p>
    </div>

    <div class="controls">
        <button onclick="changeView('image_hallway.jpg')">Hallway View</button> 
        <button onclick="changeView('image_21c14f.jpg')">Balcony View</button>
        <button onclick="changeView('image_21bcb2.jpg')">Courtyard View</button>
        <button class="exit-btn" onclick="window.location.href='index.html'">Exit to Campus</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, sphere, material;
        let lon = 0, lat = 0, phi = 0, theta = 0;
        let isUserInteracting = false, onPointerDownMouseX = 0, onPointerDownMouseY = 0, onPointerDownLon = 0, onPointerDownLat = 0;

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1100);
            
            const geometry = new THREE.SphereGeometry(500, 60, 40);
            geometry.scale(-1, 1, 1); 

            material = new THREE.MeshBasicMaterial();
            sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);

            const loader = new THREE.TextureLoader();
            loader.setCrossOrigin('anonymous');
            
            window.changeView = function(fileName) {
                // Using a placeholder image if the local file isn't found
                // REPLACE THIS LINK with your actual image path when ready
                const defaultImage = 'https://upload.wikimedia.org/wikipedia/commons/f/f0/Pano_interior_of_Saint_Sulpice%2C_Paris.jpg';
                
                loader.load(fileName, function(texture) {
                    material.map = texture;
                    material.needsUpdate = true;
                }, undefined, function(err) {
                    console.warn("Could not load local image: " + fileName + ". Loading placeholder instead.");
                    loader.load(defaultImage, (tex) => { material.map = tex; material.needsUpdate = true; });
                });
            };

            // Initial view
            changeView('image_hallway.jpg');

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            document.addEventListener('pointerdown', onPointerDown);
            window.addEventListener('resize', onWindowResize);
        }

        function onPointerDown(event) {
            isUserInteracting = true;
            onPointerDownMouseX = event.clientX;
            onPointerDownMouseY = event.clientY;
            onPointerDownLon = lon;
            onPointerDownLat = lat;
            document.addEventListener('pointermove', onPointerMove);
            document.addEventListener('pointerup', onPointerUp);
        }

        function onPointerMove(event) {
            lon = (onPointerDownMouseX - event.clientX) * 0.15 + onPointerDownLon;
            lat = (event.clientY - onPointerDownMouseY) * 0.15 + onPointerDownLat;
        }

        function onPointerUp() {
            isUserInteracting = false;
            document.removeEventListener('pointermove', onPointerMove);
            document.removeEventListener('pointerup', onPointerUp);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            lat = Math.max(-85, Math.min(85, lat));
            phi = THREE.MathUtils.degToRad(90 - lat);
            theta = THREE.MathUtils.degToRad(lon);

            camera.lookAt(
                500 * Math.sin(phi) * Math.cos(theta),
                500 * Math.cos(phi),
                500 * Math.sin(phi) * Math.sin(theta)
            );
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>